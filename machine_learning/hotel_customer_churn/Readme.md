# Прогнозирование оттока клиентов в сети отелей

([Тетрадка с проектом](https://github.com/Vanarty/Yandex-Projects/blob/main/machine_learning/hotel_customer_churn/hotel_customer_churn.ipynb))

* Автор проекта - *Иванов Артём Юрьевич*
* vanarty@yandex.ru

Заказчик этого исследования — **сеть отелей «Как в гостях»**.

Чтобы привлечь клиентов, эта сеть отелей добавила на свой сайт возможность забронировать номер без предоплаты. Однако если клиент отменял бронирование, то компания терпела убытки. Сотрудники отеля могли, например, закупить продукты к приезду гостя или просто не успеть найти другого клиента.

Чтобы решить эту проблему, необходимо разработать систему, которая предсказывает отказ от брони. Если модель покажет, что бронь будет отменена, то клиенту предлагается внести депозит. Размер депозита — 80% от стоимости номера за одни сутки и затрат на разовую уборку. Деньги будут списаны со счёта клиента, если он всё же отменит бронь.

Основная бизнес-метрика для любой сети отелей — её прибыль. Прибыль отеля — это разница между стоимостью номера за все ночи и затраты на обслуживание: как при подготовке номера, так и при проживании постояльца.

В отеле есть несколько типов номеров. В зависимости от типа номера назначается стоимость за одну ночь. Есть также затраты на уборку. Если клиент снял номер надолго, то убираются каждые два дня.

Стоимость номеров отеля:
- категория A: за ночь — 1 000, разовое обслуживание — 400;
- категория B: за ночь — 800, разовое обслуживание — 350;
- категория C: за ночь — 600, разовое обслуживание — 350;
- категория D: за ночь — 550, разовое обслуживание — 150;
- категория E: за ночь — 500, разовое обслуживание — 150;
- категория F: за ночь — 450, разовое обслуживание — 150;
- категория G: за ночь — 350, разовое обслуживание — 150.

В ценовой политике отеля используются сезонные коэффициенты: весной и осенью цены повышаются на 20%, летом — на 40%.
Убытки отеля в случае отмены брони номера — это стоимость одной уборки и одной ночи с учётом сезонного коэффициента.

На разработку системы прогнозирования заложен бюджет — 400 000. При этом необходимо учесть, что внедрение модели должно окупиться за тестовый период. Затраты на разработку должны быть меньше той выручки, которую система принесёт компании.

## Было выполнено:
1. Проведена предообработка данных, а именно обработаны неявные дубликаты, удалены объекты из обучающей и тестовой выборки, не имеющие данных по колонке `['adults']`, а так же данные были проверены на наличие аномальных значений;
2. Проведен исследовательский анализ данных (EDA), на основании которого можно говорить о:
    - дисбалансе целевого признака в обеих выборках. При обучении моделей дисбаланс был учтен с импользованием перевзвешивания классов;
    - достаточной корреляции между целевым признаком и такими числовыми признаками как `['lead_time']`, `['total_of_special_requests']`, `['required_car_parking_spaces']`, а так же категориальными признаками `['country']`, `['arrival_date_month']`, `['customer_type']`, `['distribution_channel']`, `['reserved_room_type']` и `['meal']`;
    - наличии по признакам `['arrival_date_month']`, `['customer_type']`, `['meal']` и `['reserved_room_type']` отличий в паттернах поведения клиентов в отношении отказов от бронирования (целевого признака).
3. Посчитана прибыль отеля на тестовой выборке без внедрения модели и депозитов. **Прибыль** составила **35.301 млн. руб**.
4. На обучающей выборке обучены 3 модели для предсказания целевого признака (`RandomForestClassifier`, `LogisticRegression` и `XGBClassifier`);
5. Выбрана лучшая модель (`XGBClassifier`) для предсказания отмены бронирования на тестовой выборке. Обоснованы метрики качества по которым был произведен отбор (`Recall`, `F1`). Метрики качества лучшей модели на тестовой выборке оказались ниже, что может говорить о разных паттернах поведения клиентов в обеих выборках, что подтверждено с помощью проверки модели `случайного леса`, не склонной к переобучению, на тествой выборке, которая так же показала более низкие результаты;
6. Оценена прибыль, которую принесёт модель XGBClassifier за 2017 год (на тестовой выборке). **Прибыль** составит **54.004 млн. руб.**, дополнительная прибыль по сравнению с базовым вариантом (без внедрения модели и системы депозитов) составит **18.703 млн. руб.**;

## Выводы:
Исходя из полученных статистик, а так же данных на этапе EDA, выявлены следующие особенности клиентов, склонных к отказу от брони: 
    - клиент является гражданином Португалии;
    - клиент не отменял предыдущие бронирования и вообще не останавливался в данном отеле до этого момента; 
    - клиент не связан с договором или групповым заездом; 
    - клиенту не требуются парковочные места; 
    - чаще всего клиент не указывает специальные отметки, не вносит правки в бронь;
    - чаще всего количество дней между датой бронирования и датой прибытия составляет 121 день (медиана);
    - месяц заезда клиента приходится на июль или май;
    - чаще всего количество изменений параметров заказа равно 0;
    - каналом дистрибуции заказа является 'ta/to';
    - клиент чаще всего выбирает самый дорогую по стоимости категорию номера (А);
    - клиент чаще всего вместе с номером выбирает включенный в стоимость завтрак.
    
## Рекомендации:
- внедрить в систему модель `XGBClassifier` для предсказания отмены бронирования;
- на основе предсказаний модели ввести систему депозитов для клиентов потенциально склонных к отмене бронирования;
- для ещё большего увеличения прибыли подобрать оптимальный порог классификации предсказаний модели, который позволит увеличить важную для бизнеса метрику `Recall`. 
