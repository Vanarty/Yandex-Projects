# Прогнозирование заказов такси

([Тетрадка с проектом](https://github.com/Vanarty/Yandex-Projects/blob/main/machine_learning/taxi_orders/taxi_orders.ipynb))

* Автор проекта - *Иванов Артём Юрьевич*
* vanarty@yandex.ru

Компания «Чётенькое такси» собрала исторические данные о заказах такси в аэропортах. Чтобы привлекать больше водителей в период пиковой нагрузки, нужно спрогнозировать количество заказов такси на следующий час. Необходимо построить модель для такого предсказания.

Значение метрики *RMSE* на тестовой выборке должно быть не больше 48.

**План выполнения:**

1. Загрузить данные и выполнить их ресемплирование по одному часу.
2. Проанализировать данные.
3. Обучить разные модели с различными гиперпараметрами. Сделать тестовую выборку размером 10% от исходных данных.
4. Проверить данные на тестовой выборке и сделать выводы.

Данные хранятся в файле `taxi.csv`. Количество заказов находится в столбце `num_orders` (от англ. *number of orders*, «число заказов»).

## В ходе работы было выполнено:
1. загружены данные, проведена начальная предобработка (данные проверены на пропуски, аномальные значения, монотонность, данные ресемплированы с интервалом в один час с суммированием количества заказов);
2. проведен анализ целевого признака (количество заказов такси), получена и проанализирована информация о тренде, сезонности и остатков;
3. обучена базовая модель с использованием библиотеки **Prophet**;
4. создан **собственный класс `'DataPreprocess'` для этапа Pipeline**, в котором из данных извлекаются календарные признаки, признаки на основе смещения и оконного подсчета среднего, а так же трёх доролнительных признака (`'trend'`, `'daily'`, `'weekly'`) из обученной модели **Prophet**;
5. данные предварительно разбиты на обучающую и тестовую выборки;
6. с подбором гиперпараметров и **кросс-валидации на 3-х фолдах** с помощью **GridSearchCV** обучены 3 модели: **'LGBMRegressor', 'XGBRegressor', 'CatBoostRegressor'**;
7. выбрана лучшая модель по результатам **метрики RMSE**;
8. лучшая модель оценена на тестовой (отложенной) выборке;
9. сделан вывод и даны рекомендации для возможного улучшения работы.

## Выводы:
В ходе анализа было выявлено:
- **среднее значение заказов** в течение 10 минут составляет **14 заказов**;
- распределение значений целевого признака `'num_orders'`(*количество заказов*) **соответствует Пуассоновскому распределению**;
- отмечен **восходящий тренд среднего количества заказов такси с апреля по конец августа 2018 года** (временной ряд **не стационарен**). Так же в августе отмечается **4 аномально высоких значений количества заказов**;
- присутствует сезонность в дне недели. Например в каждый 6-ой день месяца количество заказов значительно больше, чем в предыдущий 5-ый день;
- так же присутствует сезонность во времени суток. Ближе к 6 утра количество заказов минимально, пик наблюдается во второй половине дня и ночью;
- в остатках наблюдаются отмеченные ранее пики в агусте месяце.

Лучшей моделью по метрике RMSE на кросс-валидации признана модель **LGBMRegressor** (**RMSE на CV - 25.568**, **RMSE на тестовой выборке - 39.767**). Качество модели на тестовой выборке подходит под условия Заказчика (**RMSE не более 48**).

Предсказания модели **LGBMRegressor**, по сравнению с базовой моделью **Prophet**, намного ближе к фактическим значениям. Большая часть ошибок связанна **с выбросами** в данных (пиковые значения), а так же **с переходящим процессом** в интервале дат `2018-08-28` - `2018-08-31`. Возможно конец августа является самым востребованным (конец отпусков, предстоящее начало учебного года).

## Рекомендации:
1. **Собрать данные за последние 3 года** или более для отслеживания годовой сезонности. Такие данные могут позволить улучшить качество модели.
2. Определить **причину выбросов (пиков) в августе**. Если такие пики действительно являются фактом и их сложно предсказывать, возможно рассмотреть более робастную метрику (например **mean_absolute_error**).
3. Предложить рассмотреть разработку модель с использованием **преобразования Фурье**.
